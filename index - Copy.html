<!DOCTYPE html><html>
<head>
	<title>Chimpaint! Beta</title>
</head>
<body>
	<script src="latent_shapes.js"></script>
	<script src="general_vae_model.js"></script>
    <script src="https://unpkg.com/brain.js"></script>
	<canvas id="content" width="16" height="16" style="width:200px;height:200px;"></canvas>
	<hr>
	<input type="range" min="0.1" max="3" step="0.05" id="shift" value="0.3"> Shift Amount
	<hr>
	<button id="seedran">seed random</button>
	<button id="seedshift">shift image </button><br><hr><br>
	<p>Latent Shapes</p>
	<br>
	<button id="seedtroll">Troll</button>
	<button id="seedbnrj">Jon Mud BNRJ</button>
	<script defer>
		function $(a){return document.getElementById(a);}
		function arrayify(netOut){
			let netOuts = Object.keys(netOut);
			let result = [];
			for(let i=0;i<netOuts.length;i++){
				let out = netOut[netOuts[i]];
				result.push(out);
			}
			return result;
		}
		let canvas = $('content');
		let ctx = canvas.getContext('2d');
		
		let encoder = new brain.NeuralNetwork({
			hiddenLayers: [Math.floor(768 / 2), 16],
			activation: 'tanh',
			learningRate:0.005
		});

		let decoder = new brain.NeuralNetwork({
			hiddenLayers: [16, Math.floor(768 / 2)],
			activation: 'sigmoid',
			learningRate:0.03
		});
		let currentLatent = [];
		let frameChange = 0.3;
		
		encoder.fromJSON(generalNet["encoder"]);
		decoder.fromJSON(generalNet["decoder"]);
		function drawLatent(latentSpace){
		    currentLatent = latentSpace;
			let decoded = arrayify(decoder.run(latentSpace));
			let newImg = ctx.getImageData(0,0,canvas.width,canvas.height);
			for(let i=0;i<decoded.length;i+=4){
				decoded.splice(i+3,0,1);
			}
			for(let i=0;i<newImg.data.length;i++){
				newImg.data[i] = decoded[i]*255;
			}
			ctx.putImageData(newImg,0,0);
		}
		$('seedran').onclick = () => {
			let latent = [];
			for(let i=0;i<16;i++){latent.push(Math.random())}
			drawLatent(latent);
		}
		$("shift").onmouseup = () => {frameChange=parseFloat($("shift").value);}
		$('seedshift').onclick = () => {
		for(let r=1;r<5;r++){
			currentLatent[r]+=( ( Math.random() > 0.5 ? 0-Math.random() : Math.random() )*((frameChange/10)*(Math.floor(Math.random())+1)));
		}drawLatent(currentLatent);
		  }
		
		
		$('seedtroll').onclick=()=>{
			currentLatent = [...Latents["troll_normal"]];
			drawLatent(currentLatent);
		}
		$('seedbnrj').onclick=()=>{
			currentLatent = [...Latents["jon_mud_brand_new_ripped_jeans"]];
			drawLatent(currentLatent);
		}
		
		
		
		let latent = [];
		for(let i=0;i<16;i++){latent.push(Math.random())}
		drawLatent(latent);
	</script>
</body>
</html>